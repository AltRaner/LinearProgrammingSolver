<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MainMenu</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        function showSection(sectionId) {
            document.querySelectorAll('.content-section').forEach(section => {
                section.style.display = 'none';
            });
            document.getElementById(sectionId).style.display = 'block';
        }

        function updateTables() {
            const constraintsCount = document.getElementById('constraints-count').value;
            const constraintsTable = document.getElementById('constraints-table');
            constraintsTable.innerHTML = '';

            for (let i = 0; i < constraintsCount; i++) {
                constraintsTable.innerHTML += `<tr>
                    <td><input type='number' class='form-control' placeholder='x1'></td>
                    <td><input type='number' class='form-control' placeholder='x2'></td>
                    <td>
                        <select class='form-control'>
                            <option value='<='>≤</option>
                            <option value='>='>≥</option>
                        </select>
                    </td>
                    <td><input type='number' class='form-control' placeholder='B'></td>
                </tr>`;
            }
        }

        function findIntersection(line1, line2) {
            let { a: a1, b: b1, c: c1 } = line1;
            let { a: a2, b: b2, c: c2 } = line2;
            let det = a1 * b2 - a2 * b1;
            if (det === 0) return null; 
            let x = (c1 * b2 - c2 * b1) / det;
            let y = (a1 * c2 - a2 * c1) / det;
            return { x, y };
        }

        function solveGraphicalMethod() {
    const x1 = parseFloat(document.querySelector('#objective-function input:nth-child(1)').value);
    const x2 = parseFloat(document.querySelector('#objective-function input:nth-child(2)').value);
    const isMax = document.getElementById('opt-goal').checked; // true -> Max, false -> Min

    const constraints = [];
    document.querySelectorAll('#constraints-table tr').forEach(row => {
        const inputs = row.querySelectorAll('input');
        const sign = row.querySelector('select').value;
        constraints.push({
            a: parseFloat(inputs[0].value),
            b: parseFloat(inputs[1].value),
            sign: sign,
            c: parseFloat(inputs[2].value)
        });
    });

    let points = [];
    for (let i = 0; i < constraints.length; i++) {
        for (let j = i + 1; j < constraints.length; j++) {
            let intersection = findIntersection(constraints[i], constraints[j]);
            if (intersection) {
                points.push(intersection);
            }
        }
    }

    // Фильтрация точек, оставляем только те, которые удовлетворяют всем ограничениям
    points = points.filter(p => constraints.every(c => {
        return c.sign === '<=' ? c.a * p.x + c.b * p.y <= c.c : c.a * p.x + c.b * p.y >= c.c;
    }));

    let bestPoint = null;
    let bestValue = isMax ? -Infinity : Infinity;

    points.forEach(p => {
        let value = x1 * p.x + x2 * p.y;
        if ((isMax && value > bestValue) || (!isMax && value < bestValue)) {
            bestValue = value;
            bestPoint = p;
        }
    });

    if (bestPoint) {
        document.getElementById('solution-output').innerHTML = 
            `А = (${bestPoint.x.toFixed(2)}, ${bestPoint.y.toFixed(2)})<br>
            L = ${x1} * ${bestPoint.x.toFixed(2)} + ${x2} * ${bestPoint.y.toFixed(2)} = ${bestValue.toFixed(2)}`;
    } else {
        document.getElementById('solution-output').innerHTML = "Нет допустимого решения";
    }
}

function drawGraph(constraints, bestPoint) {
    const ctx = document.getElementById('graphCanvas').getContext('2d');
    const chart = new Chart(ctx, {
        type: 'scatter',
        data: {
            datasets: constraints.map((c, i) => ({
                label: `Ограничение ${i + 1}`,
                borderColor: 'rgba(0, 0, 255, 0.5)',
                showLine: true,
                data: [{ x: 0, y: c.c / c.b }, { x: c.c / c.a, y: 0 }]
            })).concat({
                label: 'Оптимальная точка',
                data: [{ x: bestPoint.x, y: bestPoint.y }],
                backgroundColor: 'red',
                pointRadius: 5
            })
        },
        options: {
            scales: {
                x: { type: 'linear', position: 'bottom' },
                y: { type: 'linear' }
            }
        }
    });
}

    </script>
</head>
<body class="container mt-4">
    <h1 class="text-center">Решение задач линейного программирования</h1>
    
    <nav class="nav nav-pills justify-content-center my-3">
        <button class="nav-link active" onclick="showSection('graphic-method')">Графический метод</button>
        <button class="nav-link" onclick="showSection('simplex-method')">Симплекс-метод</button>
        <button class="nav-link" onclick="showSection('transport-problem')">Транспортная задача</button>
    </nav>
    
    <div id="graphic-method" class="content-section" style="display: block;">
        <h2>Графический метод</h2>
        <label for="constraints-count">Количество ограничений:</label>
        <input type="number" id="constraints-count" class="form-control" min="1" value="2">
        <button class="btn btn-primary mt-2" onclick="updateTables()">Обновить таблицы</button>
        
        <h3>Коэффициенты целевой функции:</h3>
        <table class="table" id="objective-function">
            <tr>
                <td><input type="number" class="form-control" placeholder="x1"></td>
                <td><input type="number" class="form-control" placeholder="x2"></td>
            </tr>
        </table>
        
        <h3>Коэффициенты ограничений:</h3>
        <table class="table" id="constraints-table"></table>
        
        <div class="d-flex align-items-center">
    		<span class="me-2">Min</span>
    		<div class="form-check form-switch">
        		<input class="form-check-input" type="checkbox" id="opt-goal">
    		</div>
    		<span class="ms-2">Max</span>
	</div>
        
        <button class="btn btn-success mt-3" onclick="solveGraphicalMethod()">Решить</button>
        
        <h3>Результат:</h3>
	<canvas id="graphCanvas" width="200" height="200"></canvas>
        <p id="solution-output"></p>
    </div>
</body>
</html>
